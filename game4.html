<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Catch the Ball O'yini</title>
<style>
  * {
    box-sizing: border-box;
  }
  body, html {
    margin: 0; padding: 0; height: 100%; overflow: hidden;
    font-family: Arial, sans-serif;
    background: #111;
    color: white;
  }
  
  /* Yuklanish animatsiyasi */
  #loadingScreen {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: linear-gradient(135deg, #4e54c8, #8f94fb);
    display: flex; justify-content: center; align-items: center;
    flex-direction: column;
    z-index: 9999;
  }
  .loader {
    width: 70px;
    height: 70px;
    border: 8px solid rgba(255,255,255,0.2);
    border-top: 8px solid #fff;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-bottom: 15px;
  }
  @keyframes spin {
    0% { transform: rotate(0deg);}
    100% { transform: rotate(360deg);}
  }
  .loading-text {
    font-size: 24px;
    font-weight: bold;
    animation: pulse 1.5s infinite;
  }
  @keyframes pulse {
    0%, 100% { opacity: 1;}
    50% { opacity: 0.5;}
  }

  /* O'yin dizayni */
  #gameWrapper {
    width: 100%;
    height: 100%;
    display: flex; justify-content: center; align-items: center;
    position: relative;
    background: linear-gradient(#2c3e50, #34495e);
    overflow: hidden;
  }
  #gameCanvas {
    border-radius: 15px;
    box-shadow: 0 0 20px #000 inset;
  }
  #score {
    position: absolute;
    top: 15px; left: 50%;
    transform: translateX(-50%);
    font-size: 24px;
    color: #f1c40f;
    font-weight: bold;
    text-shadow: 0 0 8px #f1c40f;
    z-index: 10;
  }
  #gameOver {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    font-size: 36px;
    color: #e74c3c;
    font-weight: bold;
    display: none;
    text-align: center;
    z-index: 20;
  }
  #restartBtn {
    margin-top: 20px;
    padding: 12px 30px;
    font-size: 20px;
    border: none;
    border-radius: 25px;
    background: #27ae60;
    color: white;
    cursor: pointer;
  }

  /* Mobil boshqaruv tugmalari */
  #controls {
    position: absolute;
    bottom: 20px;
    width: 100%;
    display: flex; justify-content: space-around;
    z-index: 15;
  }
  .control-btn {
    width: 80px; height: 80px;
    background: rgba(255,255,255,0.1);
    border: 2px solid #fff;
    border-radius: 50%;
    color: white;
    font-size: 30px;
    display: flex; justify-content: center; align-items: center;
    user-select: none;
    touch-action: manipulation;
  }
  .control-btn:active {
    background: rgba(255,255,255,0.3);
  }
</style>
</head>
<body>

<div id="loadingScreen">
  <div class="loader"></div>
  <div class="loading-text">Yuklanmoqda...</div>
</div>

<div id="gameWrapper" style="display:none;">
  <div id="score">Ball: 0</div>
  <div id="gameOver">
    O'yin tugadi!<br />
    <button id="restartBtn">Qayta boshlash</button>
  </div>
  <canvas id="gameCanvas" width="400" height="600"></canvas>

  <div id="controls">
    <div class="control-btn" id="leftBtn">⟵</div>
    <div class="control-btn" id="rightBtn">⟶</div>
  </div>
</div>

<script>
  // Yuklanish ekrani 3 soniyadan so'ng yo'qoladi
  setTimeout(() => {
    document.getElementById('loadingScreen').style.display = 'none';
    document.getElementById('gameWrapper').style.display = 'flex';
    gameLoop();
  }, 3000);

  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');

  const scoreDiv = document.getElementById('score');
  const gameOverDiv = document.getElementById('gameOver');
  const restartBtn = document.getElementById('restartBtn');
  const leftBtn = document.getElementById('leftBtn');
  const rightBtn = document.getElementById('rightBtn');

  let platform = {
    x: canvas.width / 2 - 50,
    y: canvas.height - 30,
    width: 100,
    height: 20,
    speed: 7,
    dx: 0
  };

  let balls = [];
  let ballRadius = 15;
  let ballSpeed = 2;
  let spawnInterval = 1500;
  let lastSpawn = 0;

  let score = 0;
  let gameRunning = true;

  function drawPlatform() {
    ctx.fillStyle = "linear-gradient(#2ecc71, #27ae60)";
    ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
    ctx.shadowColor = '#2ecc71';
    ctx.shadowBlur = 15;
  }

  function drawBall(ball) {
    ctx.beginPath();
    ctx.fillStyle = '#f1c40f';
    ctx.shadowColor = '#f39c12';
    ctx.shadowBlur = 15;
    ctx.arc(ball.x, ball.y, ballRadius, 0, Math.PI * 2);
    ctx.fill();
  }

  function spawnBall() {
    const x = Math.random() * (canvas.width - ballRadius * 2) + ballRadius;
    balls.push({x, y: -ballRadius});
  }

  function update(deltaTime) {
    if(!gameRunning) return;

    platform.x += platform.dx;
    if(platform.x < 0) platform.x = 0;
    if(platform.x + platform.width > canvas.width) platform.x = canvas.width - platform.width;

    for(let i = balls.length -1; i >= 0; i--) {
      balls[i].y += ballSpeed;

      if(balls[i].y + ballRadius > platform.y &&
         balls[i].x > platform.x && balls[i].x < platform.x + platform.width) {
        balls.splice(i, 1);
        score++;
        scoreDiv.textContent = "Ball: " + score;
        if(score % 5 === 0) {
          ballSpeed += 0.5;
          if(spawnInterval > 500) spawnInterval -= 100;
        }
      } else if(balls[i].y - ballRadius > canvas.height) {
        gameOver();
        return;
      }
    }

    lastSpawn += deltaTime;
    if(lastSpawn > spawnInterval) {
      spawnBall();
      lastSpawn = 0;
    }
  }

  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawPlatform();
    balls.forEach(drawBall);
  }

  let lastTime = 0;
  function gameLoop(timestamp=0) {
    const deltaTime = timestamp - lastTime;
    lastTime = timestamp;
    update(deltaTime);
    draw();
    if(gameRunning) requestAnimationFrame(gameLoop);
  }

  function gameOver() {
    gameRunning = false;
    gameOverDiv.style.display = 'block';
  }

  restartBtn.onclick = function() {
    balls = [];
    ballSpeed = 2;
    spawnInterval = 1500;
    score = 0;
    gameRunning = true;
    lastSpawn = 0;
    scoreDiv.textContent = "Ball: 0";
    gameOverDiv.style.display = 'none';
    platform.x = canvas.width / 2 - platform.width / 2;
    gameLoop();
  };

  document.addEventListener('keydown', e => {
    if(e.key === "ArrowRight") platform.dx = platform.speed;
    else if(e.key === "ArrowLeft") platform.dx = -platform.speed;
  });
  document.addEventListener('keyup', e => {
    if(e.key === "ArrowRight" || e.key === "ArrowLeft") platform.dx = 0;
  });

  // Mobil boshqaruv
  leftBtn.addEventListener('touchstart', () => { platform.dx = -platform.speed; });
  rightBtn.addEventListener('touchstart', () => { platform.dx = platform.speed; });
  leftBtn.addEventListener('touchend', () => { platform.dx = 0; });
  rightBtn.addEventListener('touchend', () => { platform.dx = 0; });

</script>
</body>
</html>

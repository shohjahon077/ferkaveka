<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Murakkab Labirint O'yini ‚Äî FERKAVEKA</title>
<style>
  :root {
    --bg: #0b1e3d;
    --wall: #ff6b6b;
    --player: #39a9db;
    --goal: #7bf7a4;
    --start: #ffd86b;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body, html { width: 100%; height: 100%; font-family: Arial, sans-serif; background: var(--bg); display: flex; flex-direction: column; align-items: center; justify-content: center; }
  canvas { background: #071228; display: block; border: 3px solid #39a9db; border-radius: 12px; }
  #loading {
    position: absolute; width: 100%; height: 100%;
    background: var(--bg); display: flex; align-items: center; justify-content: center; flex-direction: column;
    color: #39a9db; font-size: 24px; font-weight: bold;
  }
  @keyframes blink { 0%,100%{opacity:1;}50%{opacity:0.3;} }
  .dot { display:inline-block;margin-left:5px;animation:blink 1s infinite; }
  #controls { display:flex; gap:10px; margin-top:12px; }
  .btn { padding:12px 18px; background:#39a9db; color:#04212c; font-weight:bold; border:none; border-radius:8px; font-size:16px; user-select:none; }
</style>
</head>
<body>

<div id="loading">Yuklanmoqda<span class="dot">.</span><span class="dot">.</span><span class="dot">.</span></div>

<canvas id="gameCanvas" width="480" height="480"></canvas>

<div id="controls">
  <button class="btn" data-dir="up">‚Üë</button>
  <button class="btn" data-dir="left">‚Üê</button>
  <button class="btn" data-dir="down">‚Üì</button>
  <button class="btn" data-dir="right">‚Üí</button>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const cellSize = 40;
const rows = 12;
const cols = 12;

// 0=yo'l, 1=devor, 2=start, 3=finish
const maze = [
  [2,0,1,1,0,0,1,0,0,0,0,1],
  [1,0,1,0,0,1,1,0,1,1,0,1],
  [1,0,0,0,1,0,0,0,1,0,1,3],
  [1,1,1,0,1,1,1,0,1,0,1,1],
  [0,0,1,0,0,0,1,0,0,0,1,0],
  [0,1,1,1,1,0,1,1,1,0,1,0],
  [0,0,0,0,1,0,0,0,1,0,0,0],
  [1,1,1,0,1,1,1,0,1,1,1,0],
  [0,0,1,0,0,0,1,0,0,0,1,0],
  [0,1,1,1,1,0,1,1,1,0,1,0],
  [0,0,0,0,1,0,0,0,1,0,0,0],
  [1,1,1,0,1,1,1,0,1,1,1,1]
];

let player = {x:0,y:0};
let start = {x:0,y:0};
let goal = {x:0,y:0};

// topiladigan start va finish joylari
for(let r=0;r<rows;r++){
  for(let c=0;c<cols;c++){
    if(maze[r][c]===2){ player={x:c,y:r}; start={x:c,y:r}; maze[r][c]=0;}
    if(maze[r][c]===3){ goal={x:c,y:r}; maze[r][c]=0;}
  }
}

// silliq harakat
let animating = false;
let targetPos = {...player};

function drawMaze(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for(let r=0;r<rows;r++){
    for(let c=0;c<cols;c++){
      if(maze[r][c]===1){
        ctx.fillStyle='var(--wall)';
        ctx.fillRect(c*cellSize, r*cellSize, cellSize, cellSize);
      }
    }
  }
  // start
  ctx.fillStyle='var(--start)';
  ctx.fillRect(start.x*cellSize,start.y*cellSize,cellSize,cellSize);
  // goal
  ctx.fillStyle='var(--goal)';
  ctx.fillRect(goal.x*cellSize,goal.y*cellSize,cellSize,cellSize);
  // player
  ctx.fillStyle='var(--player)';
  ctx.beginPath();
  ctx.arc(player.x*cellSize+cellSize/2,player.y*cellSize+cellSize/2,cellSize/3,0,Math.PI*2);
  ctx.fill();
}

function animateMove(dx,dy){
  if(animating) return;
  const nx = player.x + dx;
  const ny = player.y + dy;
  if(nx<0 || nx>=cols || ny<0 || ny>=rows || maze[ny][nx]===1) return;
  targetPos = {x:nx,y:ny};
  animating = true;
  const frames = 6;
  let frame=0;
  const startPos = {...player};
  const anim = setInterval(()=>{
    frame++;
    player.x = startPos.x + (targetPos.x-startPos.x)*(frame/frames);
    player.y = startPos.y + (targetPos.y-startPos.y)*(frame/frames);
    drawMaze();
    if(frame>=frames){
      clearInterval(anim);
      player = {...targetPos};
      animating=false;
      if(player.x===goal.x && player.y===goal.y){
        setTimeout(()=>alert('üéâ Tabriklaymiz! Maqsadga yetdingiz!'),50);
      }
    }
  },30);
}

document.addEventListener('keydown',(e)=>{
  switch(e.key){
    case 'ArrowUp': animateMove(0,-1); break;
    case 'ArrowDown': animateMove(0,1); break;
    case 'ArrowLeft': animateMove(-1,0); break;
    case 'ArrowRight': animateMove(1,0); break;
  }
});

// mobil tugmalar
document.querySelectorAll('.btn').forEach(b=>{
  b.addEventListener('click',()=> {
    const dir = b.dataset.dir;
    if(dir==='up') animateMove(0,-1);
    if(dir==='down') animateMove(0,1);
    if(dir==='left') animateMove(-1,0);
    if(dir==='right') animateMove(1,0);
  });
});

// yuklanish animatsiyasi
setTimeout(()=>{
  document.getElementById('loading').style.display='none';
  drawMaze();
},1500);
</script>

</body>
</html>
